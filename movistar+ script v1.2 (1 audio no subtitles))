@ echo off

echo MOVISTAR+/FILMIN BATCH DOWNLOADER V.1.2 POR PEPINACOS Y ROSMANDER @ 2021, BASADO EN EL TRABAJO DE U/PARNEX Y U/OWN_WESTERN8448

echo.

echo REQUISITOS; yt-dlp.exe , mp4decrypt.exe, aria2c.exe, ffmpeg.exe, SubtitleEdit.exe, wget.exe EN EL MISMO DIRECTORIO DEL .BAT.

echo.

echo EXTENSIONES NECESARIAS PARA CHROME (V.87 o ANTERIOR); WIDEVINE L3 DECRYPTOR

echo.

set path=E:\Descargas\movistar+

set /p folder= NOMBRE DEL VIDEO (SIN ESPACIOS):

echo.

mkdir E:\Descargas\movistar+\%folder%

set /p stream=URL DEL MPD :

yt-dlp --external-downloader aria2c --allow-unplayable-formats -F "%stream%" -v

rem yt-dlp --external-downloader aria2c --allow-unplayable-formats -F "%stream%"

echo.

set /p video=ID DE CALIDAD DE VIDEO :

echo.

set /p audio=ID DE CALIDAD DE AUDIO :

echo.

yt-dlp --external-downloader aria2c --allow-unplayable-formats --verbose --no-overwrites -f %video%+%audio% "%stream%" -o "E:\Descargas\movistar+\%folder%\encrypted.%%(ext)s"

echo.

ren "E:\Descargas\movistar+\%folder%\*121.mp4" encrypted.mp4

ren "E:\Descargas\movistar+\%folder%\*221.m4a" encrypted.m4a

echo.

set /p key=KEY :

echo.

set /p id=KID :

echo.

echo DESENCRIPTANDO y UNIENDO .........

mp4decrypt.exe --key %id%:%key% E:\Descargas\movistar+\%folder%\encrypted.m4a E:\Descargas\movistar+\%folder%\decrypted.m4a

mp4decrypt.exe --key %id%:%key% E:\Descargas\movistar+\%folder%\encrypted.mp4 E:\Descargas\movistar+\%folder%\decrypted.mp4

ffmpeg -hide_banner -i E:\Descargas\movistar+\%folder%\decrypted.mp4 -i E:\Descargas\movistar+\%folder%\decrypted.m4a -map 0:v -map 1:a -metadata:s:a:0 language=esp -metadata:s:a:0 title="Castellano" -acodec copy -vcodec copy E:\Descargas\movistar+\%folder%.mkv

RMDIR /s /q E:\Descargas\movistar+\%folder%

echo.

echo COMPLETADO .........

echo.

pause

cls
